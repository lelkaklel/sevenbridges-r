<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Creating Your Docker Container and Command Line Interface (with docopt) &bull; sevenbridges</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">sevenbridges</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Creating Your Docker Container and Command Line Interface (with docopt)</h1>
            
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#introduction" class="anchor"> </a></body></html>Introduction</h2>
<p><strong>In progress</strong></p>
<p>In this tutorial, we will go through ways to</p>
<ul><li>Make native command line interface in R</li>
</ul><p>There are many fun ways to do it, here I am more focused for R developers.</p>
<div id="existing-docker-repos" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#existing-docker-repos" class="anchor"> </a></body></html>Existing docker repos</h3>
<p>Before you create any, make sure you don&rsquo;t re-invent the wheel and use the best base image for your container as your tool chain may save your lots of time later on.</p>
<div id="rocker-project" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#rocker-project" class="anchor"> </a></body></html>Rocker Project</h4>
<p>Official R Docker images is called &ldquo;Rocker&rdquo;" project and is on <a href="https://github.com/rocker-org/rocker">GitHub</a>, please visit the page to find more details and Dockerfile.</p>
<table class="table"><thead><tr class="header"><th>Image</th>
<th align="center">Description</th>
</tr></thead><tbody><tr class="odd"><td><code>rocker/r-base</code></td>
<td align="center">base package to build from</td>
</tr><tr class="even"><td><code>rocker/r-devel</code></td>
<td align="center">base plus R-devel from SVN</td>
</tr><tr class="odd"><td><code>rocker/rstudio</code></td>
<td align="center">base plus RStudio Server</td>
</tr><tr class="even"><td><code>rocker/hadleyverse</code></td>
<td align="center">rstudio + Hadley&rsquo;s packages, LaTeX</td>
</tr><tr class="odd"><td><code>rocker/ropensci</code></td>
<td align="center">hadleyverse + rOpenSci packages</td>
</tr><tr class="even"><td><code>rocker/r-devel-san</code></td>
<td align="center">base, SVN&rsquo;s R-devel and SAN</td>
</tr></tbody></table></div>
<div id="bioconductor-images" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#bioconductor-images" class="anchor"> </a></body></html>Bioconductor Images</h4>
<p>Bioconductor have a nice <a href="http://bioconductor.org/help/docker/">page</a> about the official docker images, please read for more details.</p>
<table class="table"><thead><tr class="header"><th>Image</th>
</tr></thead><tbody><tr class="odd"><td>bioconductor/devel_base</td>
</tr><tr class="even"><td>bioconductor/devel_core</td>
</tr><tr class="odd"><td>bioconductor/devel_flow</td>
</tr><tr class="even"><td>bioconductor/devel_microarray</td>
</tr><tr class="odd"><td>bioconductor/devel_proteomics</td>
</tr><tr class="even"><td>bioconductor/devel_sequencing</td>
</tr><tr class="odd"><td>bioconductor/release_base</td>
</tr><tr class="even"><td>bioconductor/release_core</td>
</tr><tr class="odd"><td>bioconductor/release_flow</td>
</tr><tr class="even"><td>bioconductor/release_microarray</td>
</tr><tr class="odd"><td>bioconductor/release_proteomics</td>
</tr><tr class="even"><td>bioconductor/release_sequencing</td>
</tr></tbody></table><p>To understand the image quickly here is the short instruction for the image name:</p>
<ul><li><strong>release</strong> images are based on <code>rocker/rstudio</code></li>
<li><strong>devel</strong> images are based on <code>rocker/rstudio-daily</code></li>
<li><strong>base</strong>: Contains R, RStudio, and BiocInstaller + system dependencies.</li>
<li><strong>core</strong>: base + a selection of core.</li>
<li><strong>flow</strong>: core + all packages tagged with the <em>FlowCytometry</em> biocView.</li>
<li><strong>microarray</strong>: core + all packages tagged with the <em>Microarray</em> biocView.</li>
<li><strong>proteomics</strong>: core + all packages tagged with the <em>Proteomics</em> biocView.</li>
<li><strong>sequencing</strong>: core + all packages tagged with the <em>Sequencing</em> biocView.</li>
</ul></div>
<div id="dockerhub" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#dockerhub" class="anchor"> </a></body></html>Dockerhub</h4>
<p><a href="https://hub.docker.com/">Dockerhub</a> also provide public/private repos, you can search existing tools without building yourself, it&rsquo;s very likely some popular tool already have docker container well maintained there.</p>
</div>
<div id="seven-bridges-docker-registry" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#seven-bridges-docker-registry" class="anchor"> </a></body></html>Seven Bridges Docker Registry</h4>
<p>Tutorial comming soon.</p>
<p>Example Seven Bridges registry:</p>
<ul><li><strong>SevenBridges</strong> : <code>images.sbgenomics.com/&lt;repository&gt;[:&lt;tag&gt;]</code></li>
<li><strong>Cancer Genomics Cloud</strong>: <code>cgc-images.sbgenomics.com/&lt;repository&gt;[:&lt;tag&gt;]</code></li>
</ul></div>
</div>
</div>
<div id="tutorial-random-number-generator" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#tutorial-random-number-generator" class="anchor"> </a></body></html>Tutorial: random number generator</h2>
<p>Our goal here is to making a cwl app to generate unif random numbers, yes, the core function is <code>runif()</code>, it&rsquo;s a native function in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">runif</code></pre></div>
<pre><code>## function (n, min = 0, max = 1) 
## .Call(C_runif, n, min, max)
## &lt;bytecode: 0x1090d21c8&gt;
## &lt;environment: namespace:stats&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1001</span>)
<span class="kw">runif</span>(<span class="dv">10</span>)</code></pre></div>
<pre><code>##  [1] 0.985688783 0.412628483 0.429539246 0.419172236 0.426506559
##  [6] 0.887797565 0.006096034 0.081215761 0.288657362 0.765342145</code></pre>
<div id="using-docopt-package" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#using-docopt-package" class="anchor"> </a></body></html>Using docopt package</h3>
<p>In R, we also have a nice implementation in a package called <code>docopt</code>, developed by <em>Edwin de Jonge</em>. Check out its <a href="https://github.com/docopt/docopt.R">tutorial</a> on GitHub.</p>
<p>So let&rsquo;s quickly create a command line interface for our R scripts with a dummy example. Let&rsquo;s turn the uniform distribution function <code>runif</code> into a command line tool.</p>
<p>when you check out the help page for <code>runif</code>, here is the key information you want to mark down.</p>
<pre><code>Usage

runif(n, min = 0, max = 1)

Arguments

n    
number of observations. If length(n) &gt; 1, the length is taken to be the number required.

min, max    
lower and upper limits of the distribution. Must be finite.</code></pre>
<p>I will add one more parameter to set seed, here is the R script file called <code>runif.R</code>.</p>
<p>At the beginning of the commadn line script, I use the docopt standard to write my tool help.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">'usage: runif.R [--n=&lt;int&gt; --min=&lt;float&gt; --max=&lt;float&gt; --seed=&lt;float&gt;]</span>

<span class="st">options:</span>
<span class="st"> --n=&lt;int&gt;        number of observations. If length(n) &gt; 1, the length is taken to be the number required [default: 1].</span>
<span class="st"> --min=&lt;float&gt;   lower limits of the distribution. Must be finite [default: 0].</span>
<span class="st"> --max=&lt;float&gt;   upper limits of the distribution. Must be finite [default: 1].</span>
<span class="st"> --seed=&lt;float&gt;  seed for set.seed() function [default: 1]'</span> -&gt;<span class="st"> </span>doc

<span class="kw">library</span>(<span class="st">"docopt"</span>)</code></pre></div>
<p>Let&rsquo;s first do some testing in your R session before you make it a full functional command line tool.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">docopt</span>(doc) <span class="co">#with no argumetns provided</span></code></pre></div>
<pre><code>## List of 8
##  $ --n   : chr "1"
##  $ --min : chr "0"
##  $ --max : chr "1"
##  $ --seed: chr "1"
##  $ n     : chr "1"
##  $ min   : chr "0"
##  $ max   : chr "1"
##  $ seed  : chr "1"
## NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">docopt</span>(doc, <span class="st">"--n 10 --min=3 --max=5"</span>)</code></pre></div>
<pre><code>## List of 8
##  $ --n   : chr "10"
##  $ --min : chr "3"
##  $ --max : chr "5"
##  $ --seed: chr "1"
##  $ n     : chr "10"
##  $ min   : chr "3"
##  $ max   : chr "5"
##  $ seed  : chr "1"
## NULL</code></pre>
<p>Looks like it works, now let&rsquo;s add main function script for this command line tool.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">opts &lt;-<span class="st"> </span><span class="kw">docopt</span>(doc)
<span class="kw">set.seed</span>(opts$seed)
<span class="kw">runif</span>(<span class="dt">n =</span> <span class="kw">as.integer</span>(opts$n), 
      <span class="dt">min =</span> <span class="kw">as.numeric</span>(opts$min), 
      <span class="dt">max =</span> <span class="kw">as.numeric</span>(opts$max))</code></pre></div>
<pre><code>## [1] 0.2655087</code></pre>
<p>Add Shebang at the top of the file, this is a complete example for <code>runif.R</code> command line will be like this</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#!/usr/bin/Rscript</span>
<span class="st">'usage: runif.R [--n=&lt;int&gt; --min=&lt;float&gt; --max=&lt;float&gt; --seed=&lt;float&gt;]</span>

<span class="st">options:</span>
<span class="st"> --n=&lt;int&gt;        number of observations. If length(n) &gt; 1, the length is taken to be the number required [default: 1].</span>
<span class="st"> --min=&lt;float&gt;   lower limits of the distribution. Must be finite [default: 0].</span>
<span class="st"> --max=&lt;float&gt;   upper limits of the distribution. Must be finite [default: 1].</span>
<span class="st"> --seed=&lt;float&gt;  seed for set.seed() function [default: 1]'</span> -&gt;<span class="st"> </span>doc

<span class="kw">library</span>(<span class="st">"docopt"</span>)
opts &lt;-<span class="st"> </span><span class="kw">docopt</span>(doc)
<span class="kw">set.seed</span>(opts$seed)
<span class="kw">runif</span>(<span class="dt">n =</span> <span class="kw">as.integer</span>(opts$n), 
      <span class="dt">min =</span> <span class="kw">as.numeric</span>(opts$min), 
      <span class="dt">max =</span> <span class="kw">as.numeric</span>(opts$max))</code></pre></div>
<p>Let&rsquo;s test this command line.</p>
<pre><code>$ runif.R --help
Loading required package: methods
usage: runif.R [--n=&lt;int&gt; --min=&lt;float&gt; --max=&lt;float&gt; --seed=&lt;float&gt;]

options:
 --n=&lt;int&gt;        number of observations. If length(n) &gt; 1, the length is taken to be the number required [default: 1].
 --min=&lt;float&gt;   lower limits of the distribution. Must be finite [default: 0].
 --max=&lt;float&gt;   upper limits of the distribution. Must be finite [default: 1].
 --seed=&lt;float&gt;  seed for set.seed() function [default: 1]
$ runif.R
Loading required package: methods
[1] 0.2655087
$ runif.R
Loading required package: methods
[1] 0.2655087
$ runif.R --seed=123 --n 10 --min=1 --max=100
Loading required package: methods
 [1] 29.470174 79.042208 41.488715 88.418723 94.106261  5.510093 53.282443
 [8] 89.349485 55.592066 46.204859</code></pre>
<p>For full example you can check my GitHub <a href="https://github.com/tengfei/docker/tree/master/runif">example</a></p>
</div>
<div id="quick-command-line-interface-with-commandargs-position-and-named-args" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#quick-command-line-interface-with-commandargs-position-and-named-args" class="anchor"> </a></body></html>Quick command line interface with commandArgs (position and named args)</h3>
<p>For advanced users, please read another tutorial &ldquo;Creating Your Docker Container and Command Line Interface (with docopt)&rdquo;, &ldquo;docopt&rdquo; is more formal way to construct your command line interface, but there is a quick way to make command line interface here using just <code>commandArgs</code></p>
<p>Suppose I already have a R script like this using position mapping the arguments</p>
<ol style="list-style-type: decimal"><li>numbers</li>
<li>min</li>
<li>max</li>
</ol><div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fl &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"docker/sevenbridges/src"</span>, <span class="st">"runif2spin.R"</span>, <span class="dt">package =</span> <span class="st">"sevenbridges"</span>)
<span class="kw">cat</span>(<span class="kw">readLines</span>(fl), <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</code></pre></div>
<pre><code>#' ---
#' title: "Uniform randome number generator example"
#' output:
#'     html_document:
#'     toc: true
#' number_sections: true
#' ---

#' # summary report
#'
#' This is a randome number generator

#+
args = commandArgs(TRUE)

r = runif(n   = as.integer(args[1]),
          min = as.numeric(args[2]),
          max = as.numeric(args[3]))
head(r)
summary(r)
hist(r)</code></pre>
<p>Ignore the comment part, I will introduce spin/stich later. My base command will be somethine like</p>
<pre><code>Rscript runif2spin.R 10 30 50</code></pre>
<p>I just describe my tool in this way</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"sevenbridges"</span>)
<span class="kw">library</span>(<span class="st">"readr"</span>)
fd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CPURequirement-class.html">fileDef</a></span>(<span class="dt">name =</span> <span class="st">"runif.R"</span>,
              <span class="dt">content =</span> <span class="kw">read_file</span>(fl))

rbx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Tool-class.html">Tool</a></span>(<span class="dt">id =</span> <span class="st">"runif"</span>, 
            <span class="dt">label =</span> <span class="st">"runif"</span>,
            <span class="dt">hints =</span> <span class="kw"><a href="../reference/CPURequirement-class.html">requirements</a></span>(<span class="kw"><a href="../reference/CPURequirement-class.html">docker</a></span>(<span class="dt">pull =</span> <span class="st">"rocker/r-base"</span>), 
                                 <span class="kw"><a href="../reference/CPURequirement-class.html">cpu</a></span>(<span class="dv">1</span>), <span class="kw"><a href="../reference/CPURequirement-class.html">mem</a></span>(<span class="dv">2000</span>)),
            <span class="dt">requirements =</span> <span class="kw"><a href="../reference/CPURequirement-class.html">requirements</a></span>(fd),
            <span class="dt">baseCommand =</span> <span class="st">"Rscript runif.R"</span>,
            <span class="dt">stdout =</span> <span class="st">"output.txt"</span>,
            <span class="dt">inputs =</span> <span class="kw">list</span>(<span class="kw"><a href="../reference/CLB.html">input</a></span>(<span class="dt">id =</span> <span class="st">"number"</span>,
                                <span class="dt">type =</span> <span class="st">"integer"</span>,
                                <span class="dt">position =</span> <span class="dv">1</span>),
                          <span class="kw"><a href="../reference/CLB.html">input</a></span>(<span class="dt">id =</span> <span class="st">"min"</span>,
                                <span class="dt">type =</span> <span class="st">"float"</span>,
                                <span class="dt">position =</span> <span class="dv">2</span>),
                          <span class="kw"><a href="../reference/CLB.html">input</a></span>(<span class="dt">id =</span> <span class="st">"max"</span>,
                                <span class="dt">type =</span> <span class="st">"float"</span>,
                                <span class="dt">position =</span> <span class="dv">3</span>)),
            <span class="dt">outputs =</span> <span class="kw"><a href="../reference/CLB.html">output</a></span>(<span class="dt">id =</span> <span class="st">"random"</span>, <span class="dt">glob =</span> <span class="st">"output.txt"</span>))   </code></pre></div>
<p>Now copy-paste the json into your project app and run it in the cloud to test it</p>
<p>How about named argumentments? I will still recommend use &ldquo;docopt&rdquo; package, but for simple way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fl &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"docker/sevenbridges/src"</span>, <span class="st">"runif_args.R"</span>, <span class="dt">package =</span> <span class="st">"sevenbridges"</span>)
<span class="kw">cat</span>(<span class="kw">readLines</span>(fl), <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</code></pre></div>
<pre><code>#' ---
#' title: "Uniform randome number generator example"
#' output:
#'     html_document:
#'     toc: true
#' number_sections: true
#' ---

#' # summary report
#'
#' This is a randome number generator

#+
args &lt;- commandArgs(TRUE)

## quick hack to split named arguments
splitArgs &lt;- function(x) {
    res &lt;- do.call(rbind, lapply(x, function(i){
        res &lt;- strsplit(i, "=")[[1]]
        nm &lt;- gsub("-+", "",res[1])
        c(nm, res[2])
    }))
    .r &lt;- res[,2]
    names(.r) &lt;- res[,1]
    .r
}
args &lt;- splitArgs(args)

#+
r &lt;- runif(n   = as.integer(args["n"]),
           min = as.numeric(args["min"]),
           max = as.numeric(args["max"]))
summary(r)
hist(r)
write.csv(r, file = "out.csv")</code></pre>
<pre><code>Rscript runif_args.R --n=10 --min=30 --max=50</code></pre>
<p>I just describe my tool in this way, note, I use <code>separate=FALSE</code> and add <code>=</code> to my prefix as a hack.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"readr"</span>)
fd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CPURequirement-class.html">fileDef</a></span>(<span class="dt">name =</span> <span class="st">"runif.R"</span>,
              <span class="dt">content =</span> <span class="kw">read_file</span>(fl))

rbx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Tool-class.html">Tool</a></span>(<span class="dt">id =</span> <span class="st">"runif"</span>, 
            <span class="dt">label =</span> <span class="st">"runif"</span>,
            <span class="dt">hints =</span> <span class="kw"><a href="../reference/CPURequirement-class.html">requirements</a></span>(<span class="kw"><a href="../reference/CPURequirement-class.html">docker</a></span>(<span class="dt">pull =</span> <span class="st">"rocker/r-base"</span>), 
                                 <span class="kw"><a href="../reference/CPURequirement-class.html">cpu</a></span>(<span class="dv">1</span>), <span class="kw"><a href="../reference/CPURequirement-class.html">mem</a></span>(<span class="dv">2000</span>)),
            <span class="dt">requirements =</span> <span class="kw"><a href="../reference/CPURequirement-class.html">requirements</a></span>(fd),
            <span class="dt">baseCommand =</span> <span class="st">"Rscript runif.R"</span>,
            <span class="dt">stdout =</span> <span class="st">"output.txt"</span>,
            <span class="dt">inputs =</span> <span class="kw">list</span>(<span class="kw"><a href="../reference/CLB.html">input</a></span>(<span class="dt">id =</span> <span class="st">"number"</span>,
                                <span class="dt">type =</span> <span class="st">"integer"</span>,
                                <span class="dt">separate =</span> <span class="ot">FALSE</span>,
                                <span class="dt">prefix =</span> <span class="st">"--n="</span>),
                          <span class="kw"><a href="../reference/CLB.html">input</a></span>(<span class="dt">id =</span> <span class="st">"min"</span>,
                                <span class="dt">type =</span> <span class="st">"float"</span>,
                                <span class="dt">separate =</span> <span class="ot">FALSE</span>,
                                <span class="dt">prefix =</span> <span class="st">"--min="</span>),
                          <span class="kw"><a href="../reference/CLB.html">input</a></span>(<span class="dt">id =</span> <span class="st">"max"</span>,
                                <span class="dt">type =</span> <span class="st">"float"</span>,
                                 <span class="dt">separate =</span> <span class="ot">FALSE</span>,
                                <span class="dt">prefix =</span> <span class="st">"--max="</span>)),
            <span class="dt">outputs =</span> <span class="kw"><a href="../reference/CLB.html">output</a></span>(<span class="dt">id =</span> <span class="st">"random"</span>, <span class="dt">glob =</span> <span class="st">"output.txt"</span>))   </code></pre></div>
</div>
<div id="quick-report-spin-and-stich" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#quick-report-spin-and-stich" class="anchor"> </a></body></html>Quick report: Spin and Stich</h3>
<p>Alternative, you can use spin/stich from knitr to generate report directly from a Rscript with special format. For example, let&rsquo;s use above example</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fl &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"docker/sevenbridges/src"</span>, <span class="st">"runif_args.R"</span>, <span class="dt">package =</span> <span class="st">"sevenbridges"</span>)
<span class="kw">cat</span>(<span class="kw">readLines</span>(fl), <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</code></pre></div>
<pre><code>#' ---
#' title: "Uniform randome number generator example"
#' output:
#'     html_document:
#'     toc: true
#' number_sections: true
#' ---

#' # summary report
#'
#' This is a randome number generator

#+
args &lt;- commandArgs(TRUE)

## quick hack to split named arguments
splitArgs &lt;- function(x) {
    res &lt;- do.call(rbind, lapply(x, function(i){
        res &lt;- strsplit(i, "=")[[1]]
        nm &lt;- gsub("-+", "",res[1])
        c(nm, res[2])
    }))
    .r &lt;- res[,2]
    names(.r) &lt;- res[,1]
    .r
}
args &lt;- splitArgs(args)

#+
r &lt;- runif(n   = as.integer(args["n"]),
           min = as.numeric(args["min"]),
           max = as.numeric(args["max"]))
summary(r)
hist(r)
write.csv(r, file = "out.csv")</code></pre>
<p>You command is something like this</p>
<pre><code>Rscript -e "rmarkdown::render(knitr::spin('runif_args.R', FALSE))" --args --n=100 --min=30 --max=50</code></pre>
<p>And so I describe my tool like this with docker image <code>rocker/hadleyverse</code> this contians knitr and rmarkdown package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"readr"</span>)
fd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CPURequirement-class.html">fileDef</a></span>(<span class="dt">name =</span> <span class="st">"runif.R"</span>,
              <span class="dt">content =</span> <span class="kw">read_file</span>(fl))

rbx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Tool-class.html">Tool</a></span>(<span class="dt">id =</span> <span class="st">"runif"</span>, 
            <span class="dt">label =</span> <span class="st">"runif"</span>,
            <span class="dt">hints =</span> <span class="kw"><a href="../reference/CPURequirement-class.html">requirements</a></span>(<span class="kw"><a href="../reference/CPURequirement-class.html">docker</a></span>(<span class="dt">pull =</span> <span class="st">"rocker/hadleyverse"</span>), 
                                 <span class="kw"><a href="../reference/CPURequirement-class.html">cpu</a></span>(<span class="dv">1</span>), <span class="kw"><a href="../reference/CPURequirement-class.html">mem</a></span>(<span class="dv">2000</span>)),
            <span class="dt">requirements =</span> <span class="kw"><a href="../reference/CPURequirement-class.html">requirements</a></span>(fd),
            <span class="dt">baseCommand =</span> <span class="st">"Rscript -e </span><span class="ch">\"</span><span class="st">rmarkdown::render(knitr::spin('runif.R', FALSE))</span><span class="ch">\"</span><span class="st"> --args"</span>,
            <span class="dt">stdout =</span> <span class="st">"output.txt"</span>,
            <span class="dt">inputs =</span> <span class="kw">list</span>(<span class="kw"><a href="../reference/CLB.html">input</a></span>(<span class="dt">id =</span> <span class="st">"number"</span>,
                                <span class="dt">type =</span> <span class="st">"integer"</span>,
                                 <span class="dt">separate =</span> <span class="ot">FALSE</span>,
                                <span class="dt">prefix =</span> <span class="st">"--n="</span>),
                          <span class="kw"><a href="../reference/CLB.html">input</a></span>(<span class="dt">id =</span> <span class="st">"min"</span>,
                                <span class="dt">type =</span> <span class="st">"float"</span>,
                                 <span class="dt">separate =</span> <span class="ot">FALSE</span>,
                                <span class="dt">prefix =</span> <span class="st">"--min="</span>),
                          <span class="kw"><a href="../reference/CLB.html">input</a></span>(<span class="dt">id =</span> <span class="st">"max"</span>,
                                <span class="dt">type =</span> <span class="st">"float"</span>,
                                <span class="dt">separate =</span> <span class="ot">FALSE</span>,
                                <span class="dt">prefix =</span> <span class="st">"--max="</span>)),
            <span class="dt">outputs =</span> <span class="kw">list</span>(<span class="kw"><a href="../reference/CLB.html">output</a></span>(<span class="dt">id =</span> <span class="st">"stdout"</span>, <span class="dt">type =</span> <span class="st">"file"</span>, <span class="dt">glob =</span> <span class="st">"output.txt"</span>),
                           <span class="kw"><a href="../reference/CLB.html">output</a></span>(<span class="dt">id =</span> <span class="st">"random"</span>, <span class="dt">type =</span> <span class="st">"file"</span>, <span class="dt">glob =</span> <span class="st">"*.csv"</span>),
                           <span class="kw"><a href="../reference/CLB.html">output</a></span>(<span class="dt">id =</span> <span class="st">"report"</span>, <span class="dt">type =</span> <span class="st">"file"</span>, <span class="dt">glob =</span> <span class="st">"*.html"</span>)))</code></pre></div>
<p>You will get a report in the end</p>
</div>
<div id="executable-report-with-r-markdown-advanced" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#executable-report-with-r-markdown-advanced" class="anchor"> </a></body></html>Executable report with R markdown (advanced)</h3>
<p>We cannot really make a Rmarkdown file executable in it by simply put</p>
<pre><code>#!/bin/bash/Rscript</code></pre>
<p>In your markdown</p>
<p>Of course, we can figure out a way to do it in <code>liftr</code> or <code>knitr</code>. But rmarkdown allow you to pass parameters to your Rmardown template, please read this tutorial <a href="http://rmarkdown.rstudio.com/developer_parameterized_reports.html">Parameterized Reports</a>. This doesn&rsquo;t solve my problem that I want to directly describe command line interface in the markdown template. However, here is alternative method:</p>
<p>Create an command line interface to pass <code>params</code> from docopt into <code>rmarkdown::render()</code> function. In this way, we can pass as many as possible parameters from command line interface into our Rmarkdown template.</p>
<p>So here we go, here is updated methods and it&rsquo;s also what I use for another tutorial about RNA-seq workflow.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fl &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"docker/sevenbridges/src/"</span>, <span class="st">"runif.R"</span>, <span class="dt">package =</span> <span class="st">"sevenbridges"</span>)</code></pre></div>
<p>Here is the current content of command line interface</p>
<pre><code>#!/usr/local/bin/Rscript
'usage: runif.R [--n=&lt;int&gt; --min=&lt;float&gt; --max=&lt;float&gt; --seed=&lt;float&gt;]

options:
--n=&lt;int&gt;        number of observations. If length(n) &gt; 1, the length is taken to be the number required [default: 1].
--min=&lt;float&gt;   lower limits of the distribution. Must be finite [default: 0].
--max=&lt;float&gt;   upper limits of the distribution. Must be finite [default: 1].
--seed=&lt;float&gt;  seed for set.seed() function [default: 1]'  -&gt; doc

library(docopt)
opts &lt;- docopt(doc)

## create param list
lst &lt;- list(n = as.integer(opts$n),
            min = as.numeric(opts$min),
            max = as.numeric(opts$max),
            seed = as.numeric(opts$seed))

## execute your Rmarkdown with these parameters
rmarkdown::render("/report/report.Rmd", rmarkdown::html_document(toc = TRUE),
                  output_dir = ".", params = lst)</code></pre>
<p>And here is the report template</p>
<pre><code>---
title: "Uniform randome number generator example"
output:
  rmarkdown::html_document:
    toc: true
    number_sections: true
    css: style.css
params:
  seed: 1
  n: 1
  min: 0
  max: 1
---

## Summary
```{r}
set.seed(params$seed)
r = runif(n   = as.integer(params$n), 
          min = as.numeric(params$min), 
          max = as.numeric(params$max))
summary(r)
hist(r)
```</code></pre>
</div>
</div>
<div id="setup-dockerhub-automated-build" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#setup-dockerhub-automated-build" class="anchor"> </a></body></html>Setup dockerhub automated build</h2>
<p>To make things more reproducible and explicit and automatic, you can do a autohook to automatically build your container/image on docker hub. Here is what I do</p>
<ol style="list-style-type: decimal"><li>I created some project called &lsquo;docker&rsquo; on my GitHub and it has all container that crated from a Dockerfile, for example, tengfei/docker/runif, please go <a href="https://github.com/tengfei/docker/tree/master/runif">here</a> to check it out</li>
<li>This folder root has a Dockerfile and subfolders for extra materials I added at build time, like script or report template.</li>
<li>login your dockerhub account, following this <a href="https://docs.docker.com/docker-hub/builds/">tutorial</a> to make &ldquo;automated build&rdquo; from your GitHub account. Make sure you input the right location for your Dockerfile, by customizing it.</li>
<li>Then you will have auto-build every time you push a new update in GitHub.</li>
<li>Start using your docker image like &lsquo;tengfei/runif&rsquo;</li>
<li>Feel free to push it onto your Seven Bridges platform registry as well.</li>
</ol></div>
<div id="more-examples" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#more-examples" class="anchor"> </a></body></html>More examples</h2>
<p>There are more examples under &lsquo;inst/docker&rsquo; folder, you can check out how to describe command line and build docker, how to make report template. You may read the online GitHub <a href="https://github.com/sbg/sevenbridges-r/tree/master/inst/docker">code</a>. Or you could read another tutorial about how we wrap RNA-seq workflow from bioconductor.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#introduction">Introduction</a></li>
      <li><a href="#tutorial-random-number-generator">Tutorial: random number generator</a></li>
      <li><a href="#setup-dockerhub-automated-build">Setup dockerhub automated build</a></li>
      <li><a href="#more-examples">More examples</a></li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nan Xiao, Dusan Randjelovic, Tengfei Yin, Seven Bridges Genomics.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
